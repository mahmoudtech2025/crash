<!DOCTYPE html>

<html lang="ar">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>تسجيل الدخول وإنشاء حساب</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>

        body {

            font-family: 'Cairo', sans-serif;

            margin: 0;

            padding: 0;

        }



        .container {

            max-width: 400px;

            margin: 80px auto;

            background: white;

            padding: 20px;

            border-radius: 12px;

            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);

            text-align: center;

            position: relative;

            z-index: 10;

        }



        h2, h3 {

            font-weight: 600;

            color: #333;

        }



        .btn {

            width: 100%;

            font-weight: 600;

            border-radius: 8px;

            transition: all 0.3s ease;

        }



        .btn-primary {

            background-color: #007bff;

            border: none;

        }



        .btn-primary:hover {

            background-color: #0056b3;

        }



        .btn-success {

            background-color: #28a745;

            border: none;

        }



        .btn-success:hover {

            background-color: #1e7e34;

        }



        .form-control {

            margin-bottom: 15px;

            border-radius: 8px;

        }



        .telegram-link {

            text-align: center;

            margin-top: 20px;

        }



        .telegram-link a {

            font-size: 18px;

            color: #0088cc;

            text-decoration: none;

            transition: color 0.3s ease;

        }



        .telegram-link a:hover {

            color: #0056b3;

        }



        body {

            background: linear-gradient(to right, #6a11cb, #2575fc);

            height: 100vh;

            display: flex;

            justify-content: center;

            align-items: center;

            background-size: cover;

        }



        .dashboard-container {

            position: relative;

            width: 100%;

            height: 100vh;

            background-color: #f7faff;

            padding: 20px;

            overflow: hidden;

        }



        .dashboard-header {

            position: absolute;

            top: 10px;

            left: 20px;

            font-size: 1.2rem;

            font-weight: bold;

            color: #333;

        }



        .dashboard-footer {

            position: fixed;

            bottom: 0;

            left: 0;

            width: 100%;

            display: flex;

            justify-content: space-between;

            background-color: #fff;

            box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);

        }



        .dashboard-footer button {

            flex: 1;

            padding: 15px;

            border: none;

            background-color: #007bff;

            color: #fff;

            font-size: 1rem;

            cursor: pointer;

            transition: background-color 0.3s ease, transform 0.2s ease;

        }



        .dashboard-footer button:hover {

            background-color: #0056b3;

            transform: scale(1.05);

        }



        .dashboard-footer button:not(:last-child) {

            border-right: 1px solid #ccc;

        }



        .logout-btn {

            position: absolute;

            top: 10px;

            right: 20px;

            background-color: transparent;

            color: #007bff;

            border: none;

            font-size: 1.2rem;

            cursor: pointer;

        }



        .logout-btn:hover {

            color: #0056b3;

            text-decoration: underline;

        }



        .logout-btn {

            transition: transform 0.3s ease;

        }



        .logout-btn:hover {

            transform: scale(1.1);

        }



        .deposit-container {

            display: none;

            max-width: 400px;

            margin: 80px auto;

            background: white;

            padding: 20px;

            border-radius: 12px;

            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);

        }



        .deposit-header {

            font-size: 1.5rem;

            font-weight: bold;

            color: #333;

            text-align: center;

        }



        .deposit-btn {

            background-color: #28a745;

            border: none;

            padding: 12px 20px;

            color: white;

            font-size: 1rem;

            width: 100%;

            cursor: pointer;

            border-radius: 8px;

            margin-top: 20px;

        }



        .deposit-btn:hover {

            background-color: #218838;

        }



        @media (max-width: 768px) {

            .container {

                margin: 40px auto;

                padding: 15px;

            }



            h2, h3 {

                font-size: 1.5rem;

            }



            .btn {

                font-size: 0.9rem;

                padding: 10px;

            }

        }

    </style>

</head>

<body>



    <div id="app" class="container">

        <h2 class="text-center" id="welcome-title">مرحبًا بك</h2>



        <div id="login-form">

            <h3 id="login-title">تسجيل الدخول</h3>

            <form onsubmit="loginUser(event)">

                <input type="text" id="login-username" class="form-control" placeholder="اسم المستخدم" required>

                <input type="password" id="login-password" class="form-control" placeholder="كلمة المرور" required>

                <button type="submit" class="btn btn-primary" id="login-btn">دخول</button>

            </form>

            <p class="text-center mt-3">

                <span id="no-account">لا تملك حساب؟</span> <a href="#" onclick="toggleForms('register')" id="register-link">إنشاء حساب</a>

            </p>

        </div>



        <div id="register-form" style="display: none;">

            <h3 id="register-title">إنشاء حساب</h3>

            <form onsubmit="registerUser(event)">

                <input type="text" id="reg-username" class="form-control" placeholder="اسم المستخدم" required>

                <input type="password" id="reg-password" class="form-control" placeholder="كلمة المرور" required>

                <input type="password" id="reg-confirm-password" class="form-control" placeholder="تأكيد كلمة المرور" required>

                <button type="submit" class="btn btn-success" id="register-btn">إنشاء حساب</button>

            </form>

            <p class="text-center mt-3">

                <span id="have-account">لديك حساب؟</span> <a href="#" onclick="toggleForms('login')" id="login-link">تسجيل الدخول</a>

            </p>

        </div>



        <div class="dashboard-container" id="dashboard" style="display: none;">

            <button class="logout-btn" onclick="logoutUser()">الخروج</button>

            <div class="dashboard-header" id="username"></div>

            <div id="balance">الرصيد: 0</div> <!-- خانة الرصيد -->

            <div class="dashboard-footer">

                <button onclick="showDepositForm()">إيداع</button>

                <button onclick="alert('لعبة')">لعبة</button>

                <button onclick="alert('سحب')">سحب</button>

            </div>

        </div>



        <div class="deposit-container" id="deposit-form">

            <div class="deposit-header">إيداع الأموال</div>

            <form onsubmit="submitDeposit(event)">

                <input type="number" id="deposit-amount" class="form-control" placeholder="أدخل قيمة الإيداع" required>

                <input type="text" id="deposit-phone" class="form-control" placeholder="أدخل رقم الهاتف (11 رقم)" required>

                <div class="mt-3">

                    <label>اختر الرقم:</label>

                    <div>

                        <input type="radio" id="number1" name="phone-number" value="01097000178" required>

                        <label for="number1">01097000178</label>

                    </div>

                    <div>

                        <input type="radio" id="number2" name="phone-number" value="01112585208" required>

                        <label for="number2">01112585208</label>

                    </div>

                </div>

                <button type="submit" class="deposit-btn">إتمام الإيداع</button>

            </form>

        </div>

    </div>



    <script>

        const API_URL = "https://backend-theta-tawny-74.vercel.app";



        let userBalance = 0; // رصيد المستخدم



        function toggleForms(form) {

            if (form === 'login') {

                document.getElementById('login-form').style.display = 'block';

                document.getElementById('register-form').style.display = 'none';

            } else if (form === 'register') {

                document.getElementById('login-form').style.display = 'none';

                document.getElementById('register-form').style.display = 'block';

            }

        }



        async function loginUser(event) {

            event.preventDefault();

            const username = document.getElementById('login-username').value.trim();

            const password = document.getElementById('login-password').value.trim();



            try {

                const response = await fetch(`${API_URL}/login`, {

                    method: 'POST',

                    headers: { 'Content-Type': 'application/json' },

                    body: JSON.stringify({ username, password })

                });



                const result = await response.json();

                if (result.success) {

                    localStorage.setItem('username', username);

                    userBalance = result.balance || 0; // تحديث الرصيد عند تسجيل الدخول

                    document.getElementById('username').textContent = username;

                    document.getElementById('balance').textContent = `الرصيد: ${userBalance}`;

                    document.getElementById('dashboard').style.display = 'block';

                    Swal.fire("مرحبًا", result.message, "success");

                    document.getElementById('login-form').style.display = 'none';

                    document.getElementById('register-form').style.display = 'none';

                } else {

                    Swal.fire("خطأ", result.message, "error");

                }

            } catch (error) {

                Swal.fire("خطأ", "حدث خطأ أثناء تسجيل الدخول. حاول لاحقًا.", "error");

            }

        }



        async function registerUser(event) {

            event.preventDefault();

            const username = document.getElementById('reg-username').value.trim();

            const password = document.getElementById('reg-password').value.trim();

            const confirmPassword = document.getElementById('reg-confirm-password').value.trim();



            if (password !== confirmPassword) {

                return Swal.fire("خطأ", "كلمة المرور غير متطابقة", "error");

            }



            try {

                const response = await fetch(`${API_URL}/register`, {

                    method: 'POST',

                    headers: { 'Content-Type': 'application/json' },

                    body: JSON.stringify({ username, password })

                });



                const result = await response.json();

                if (result.success) {

                    localStorage.setItem('username', username);

                    userBalance = 0; // تعيين رصيد المستخدم إلى 0 عند التسجيل

                    document.getElementById('username').textContent = username;

                    document.getElementById('balance').textContent = `الرصيد: ${userBalance}`;

                    document.getElementById('dashboard').style.display = 'block';

                    Swal.fire("نجاح", result.message, "success");

                    document.getElementById('login-form').style.display = 'none';

                    document.getElementById('register-form').style.display = 'none';

                } else {

                    Swal.fire("خطأ", result.message, "error");

                }

            } catch (error) {

                Swal.fire("خطأ", "حدث خطأ أثناء إنشاء الحساب. حاول لاحقًا.", "error");

            }

        }



        function showDepositForm() {

            document.getElementById('deposit-form').style.display = 'block';

            document.getElementById('dashboard').style.display = 'none';

        }



        async function submitDeposit(event) {

    event.preventDefault();



    // تحقق من وجود اسم المستخدم في localStorage

    const username = localStorage.getItem('username');

    if (!username) {

        return Swal.fire("خطأ", "إسم المستخدم غير موجود. يرجى تسجيل الدخول أولاً.", "error");

    }



    const depositAmount = parseFloat(document.getElementById('deposit-amount').value.trim());

    const depositPhone = document.getElementById('deposit-phone').value.trim();

    const selectedNumber = document.querySelector('input[name="phone-number"]:checked');



    if (!selectedNumber) {

        return Swal.fire("خطأ", "يجب اختيار رقم الهاتف", "error");

    }



    if (depositPhone.length !== 11) {

        return Swal.fire("خطأ", "رقم الهاتف يجب أن يكون 11 رقمًا", "error");

    }



    const phoneNumber = selectedNumber.value;



    // عرض الرسالة للمستخدم "جاري إضافة الرصيد"

    Swal.fire({

        title: 'جاري إضافة الرصيد إلى حسابك...',

        text: 'يرجى الانتظار لحظات.',

        showConfirmButton: false,

        willOpen: () => {

            Swal.showLoading();

        }

    });



    try {

        const response = await fetch(`${API_URL}/deposit`, {

            method: 'POST',

            headers: { 'Content-Type': 'application/json' },

            body: JSON.stringify({

                username: username,

                depositAmount,

                depositPhone,

                phoneNumber

            })

        });



        const result = await response.json();

        if (result.success) {

            // عند نجاح العملية، إظهار رسالة تفيد بأنه سيتم تحديث الرصيد لاحقًا

            Swal.fire("نجاح", "تمت إضافة طلب الإيداع. سيتم تحديث رصيدك بعد معالجة الإيداع.", "success");

            document.getElementById('deposit-form').style.display = 'none';

            document.getElementById('dashboard').style.display = 'block';

        } else {

            Swal.fire("خطأ", result.message, "error");

        }

    } catch (error) {

        Swal.fire("خطأ", "حدث خطأ أثناء الإيداع. حاول لاحقًا.", "error");

    }

        }

        function pollDepositStatus(depositId) {

    const interval = setInterval(() => {

        fetch(`/poll-deposit-status/${depositId}`)

            .then(response => response.json())

            .then(data => {

                if (data.success && data.status === "Completed") {

                    clearInterval(interval); // إيقاف الـ polling

                    alert("تم تحديث الإيداع بنجاح");



                    // تحديث الرصيد بعد اكتمال الإيداع

                    userBalance += data.depositAmount; // إضافة المبلغ المودع إلى الرصيد الحالي

                    document.getElementById('balance').textContent = `الرصيد: ${userBalance}`;

                } else {

                    console.log("الإيداع لا يزال في حالة " + data.status);

                }

            })

            .catch(error => {

                console.error("❌ خطأ في الـ polling:", error);

                clearInterval(interval); // إيقاف الـ polling في حالة حدوث خطأ

            });

    }, 5000); // يتم التحقق من الحالة كل 5 ثوانٍ

        }

        function logoutUser() {

            localStorage.removeItem('username');

            document.getElementById('dashboard').style.display = 'none';

            document.getElementById('login-form').style.display = 'block';

            Swal.fire("تم تسجيل الخروج", "لقد تم تسجيل الخروج بنجاح", "success");

        }

        window.onload = function() {

    const username = localStorage.getItem('username');

    if (username) {

        // إذا كان اسم المستخدم موجودًا في localStorage، قم بتسجيل الدخول تلقائيًا

        document.getElementById('username').textContent = username;

        document.getElementById('balance').textContent = `الرصيد: ${userBalance}`;

        document.getElementById('dashboard').style.display = 'block';

        document.getElementById('login-form').style.display = 'none';

        document.getElementById('register-form').style.display = 'none';

    } else {

        // إذا لم يكن موجودًا، قم بإظهار نموذج تسجيل الدخول

        document.getElementById('login-form').style.display = 'block';

        document.getElementById('register-form').style.display = 'none';

    }

};

    </script>

</body>

                    </html>
